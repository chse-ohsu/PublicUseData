<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>030CreateTranslation</title>

<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 12px;
   margin: 8px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 { 
   font-size:2.2em; 
}

h2 { 
   font-size:1.8em; 
}

h3 { 
   font-size:1.4em; 
}

h4 { 
   font-size:1.0em; 
}

h5 { 
   font-size:0.9em; 
}

h6 { 
   font-size:0.8em; 
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre {	
   margin-top: 0;
   max-width: 95%;
   border: 1px solid #ccc;
   white-space: pre-wrap;
}

pre code {
   display: block; padding: 0.5em;
}

code.r, code.cpp {
   background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * { 
      background: transparent !important; 
      color: black !important; 
      filter:none !important; 
      -ms-filter: none !important; 
   }

   body { 
      font-size:12pt; 
      max-width:100%; 
   }
       
   a, a:visited { 
      text-decoration: underline; 
   }

   hr { 
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote { 
      padding-right: 1em; 
      page-break-inside: avoid; 
   }

   tr, img { 
      page-break-inside: avoid; 
   }

   img { 
      max-width: 100% !important; 
   }

   @page :left { 
      margin: 15mm 20mm 15mm 10mm; 
   }
     
   @page :right { 
      margin: 15mm 10mm 15mm 20mm; 
   }

   p, h2, h3 { 
      orphans: 3; widows: 3; 
   }

   h2, h3 { 
      page-break-after: avoid; 
   }
}

</style>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: rgb(88, 72, 246)
   }

   pre .number {
     color: rgb(0, 0, 205);
   }

   pre .comment {
     color: rgb(76, 136, 107);
   }

   pre .keyword {
     color: rgb(0, 0, 255);
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: rgb(3, 106, 7);
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>




</head>

<body>
<h1>030CreateTranslation</h1>

<h2>Purpose</h2>

<ul>
<li>Download files from <a href="http://www.fda.gov/Drugs/InformationOnDrugs/ucm142438.htm">FDA.gov</a> and create R data frames</li>
<li>Join the Product dataset to the Package dataset</li>
<li>Classify the Package Codes into format types

<ul>
<li>4-4-2</li>
<li>5-3-2</li>
<li>5-4-1</li>
</ul></li>
<li>Translate the 10-digit hypenated format to an 11-digit non-hypenated format</li>
<li>Export to tab-delimited text files</li>
</ul>

<h2>Details</h2>

<blockquote>
<p>From: Brie Noble<br/>
Sent: Wednesday, January 08, 2014 3:33 PM<br/>
To: Benjamin Chan<br/>
Cc: Brie Noble; Miriam Elman<br/>
Subject: RE: NDC codes  </p>

<p>Hi Ben,</p>

<p>So are the APAC NDC codes 11 digits without hyphens?</p>

<p>I am pretty sure to go from the 10 digit codes with hypens to the 11 digit
codes without hyphens you follow this rule:</p>

<p>If the 10 digit format is 4-4-2 meaning ####-####-## then you add a leading
zero to the first segment (0####-####-##) and then drop the hyphens so the 11
digit code would be 0##########</p>

<p>If the 10 digit format is 5-3-2 meaning #####-###-## then you add a leading
zero to the second segment (#####-0###-##) and then drop the hyphens so the 11
digit code would be #####0#####</p>

<p>If the 10 digit format is 5-4-1 meaning #####-####-# then you add a leading
zero to the second segment (#####-####-0#) and then drop the hyphens so the 11
digit code would be #########0#</p>

<p>Hope that makes sense. So if I am reading correctly you will have to take the
package codes reported on the FDA website and transform them to the 11 digit
code and then merge in with the APAC data.</p>

<p>Let me know if you need help with the programming in SAS, in the past I think
I have parsed the string into 3 variables using an array and the scan function
with a hyphen for a delimiter and then use the length function to assess the
length of each of the parsed string and then add in the leading zero to
whichever one doesnât meet the criteria, (i.e. the first parsed string should
be length 5, the second length 4, and the third length 3) then you can
concatenate them together.</p>

<p>Let me know if you have any questions!</p>

<p>Best,<br/>
Brie</p>

<p>From: Benjamin Chan<br/>
Sent: Wednesday, January 08, 2014 2:58 PM<br/>
To: Brie Noble<br/>
Subject: NDC codes  </p>

<p>Hey Brie,</p>

<p>A few months ago I asked you about the format of NDC codes in APAC. Iâm
revisiting this for a different project.</p>

<p>Hereâs the information I got from James Oliver over at OHPR when I asked about
what format the NDC codes are in in APAC and why I couldnât merge drug details
from the FDA website.</p>

<blockquote>
<p>The NDC field contains package codes in the historical NDC format (length 11,
no delimiter, leading zeros preserved). Eventually insurers will need to move
away from this format, but AFAIK it is still the EDI transaction standard.</p>

<p>James</p>
</blockquote>

<p>Do you know what this âhistorical NDC formatâ is? More importantly, where I
can download a database of drug details that uses this format?</p>

<p>For reference, hereâs the FDA website from which Iâve downloaded drug
information from: <a href="http://www.fda.gov/drugs/informationondrugs/ucm142438.htm">http://www.fda.gov/drugs/informationondrugs/ucm142438.htm</a>.
The NDC database file doesnât seem to be compatible with the âhistorical NDC
formatâ codes used in APAC.</p>

<p>~<br/>
Benjamin Chan, MS, Research Associate</p>
</blockquote>

<h2>Download</h2>

<p>Download the zip archive from the <a href="http://www.fda.gov/Drugs/InformationOnDrugs/ucm142438.htm">FDA.gov</a> website. Unzip the archive. Read the two datasets into data frames, <code>dProd</code> for the Product Code table and <code>dPack</code> for the Package Code table.</p>

<p>Code is from <a href="http://stackoverflow.com/a/3053883/1427069">Stackoverflow</a>.</p>

<pre><code class="r">url &lt;- &quot;http://www.fda.gov/downloads/Drugs/DevelopmentApprovalProcess/UCM070838.zip&quot;
f &lt;- tempfile()
download.file(url, f)
t &lt;- unz(f, &quot;product.txt&quot;)
dProd &lt;- read.delim(t, stringsAsFactors = FALSE)
t &lt;- unz(f, &quot;package.txt&quot;)
dPack &lt;- read.delim(t, stringsAsFactors = FALSE)
unlink(f)
</code></pre>

<p>Rename variables to lower case.</p>

<pre><code class="r">names(dProd) &lt;- tolower(names(dProd))
names(dPack) &lt;- tolower(names(dPack))
</code></pre>

<h2>Join</h2>

<p>Join the Product dataset to the Package dataset.</p>

<pre><code class="r">require(dplyr, quietly = TRUE)
</code></pre>

<pre><code>## 
## Attaching package: &#39;dplyr&#39;
## 
## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag
## 
## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union
</code></pre>

<pre><code class="r">d &lt;- inner_join(dProd, dPack)
</code></pre>

<pre><code>## Joining by: c(&quot;productid&quot;, &quot;productndc&quot;)
</code></pre>

<h2>Classify</h2>

<p>Classify the Package Codes into format categories</p>

<ul>
<li>4-4-2</li>
<li>5-3-2</li>
<li>5-4-1</li>
</ul>

<pre><code class="r">isFmt442 &lt;- grepl(&quot;[[:alnum:]]{4}-[[:alnum:]]{4}-[[:alnum:]]{2}&quot;, d$ndcpackagecode)
isFmt532 &lt;- grepl(&quot;[[:alnum:]]{5}-[[:alnum:]]{3}-[[:alnum:]]{2}&quot;, d$ndcpackagecode)
isFmt541 &lt;- grepl(&quot;[[:alnum:]]{5}-[[:alnum:]]{4}-[[:alnum:]]{1}&quot;, d$ndcpackagecode)
fmt &lt;- rep(NA, nrow(d))
fmt[isFmt442] &lt;- &quot;4-4-2 format&quot;
fmt[isFmt532] &lt;- &quot;5-3-2 format&quot;
fmt[isFmt541] &lt;- &quot;5-4-1 format&quot;
table(fmt, useNA = &quot;ifany&quot;)
</code></pre>

<pre><code>## fmt
## 4-4-2 format 5-3-2 format 5-4-1 format 
##        21322        81483        44663
</code></pre>

<pre><code class="r">d$fmtPackageCode &lt;- format(fmt)
</code></pre>

<h2>Translate</h2>

<p>Split the 10-digit hypenated package code.</p>

<pre><code class="r">ndcSplit &lt;- strsplit(d$ndcpackagecode, &quot;-&quot;)
</code></pre>

<p>This returns a list. Convert the list to a data frame for easier manipulation.</p>

<pre><code class="r">ndcSplit &lt;- data.frame(matrix(unlist(ndcSplit), ncol = 3, byrow = TRUE))
</code></pre>

<p>Translate.</p>

<pre><code class="r">d$ndcPackageFmt11[isFmt442] &lt;- paste0(&quot;0&quot;, ndcSplit$X1[isFmt442], ndcSplit$X2[isFmt442], 
    ndcSplit$X3[isFmt442])
d$ndcPackageFmt11[isFmt532] &lt;- paste0(ndcSplit$X1[isFmt532], &quot;0&quot;, ndcSplit$X2[isFmt532], 
    ndcSplit$X3[isFmt532])
d$ndcPackageFmt11[isFmt541] &lt;- paste0(ndcSplit$X1[isFmt541], ndcSplit$X2[isFmt541], 
    &quot;0&quot;, ndcSplit$X3[isFmt541])
</code></pre>

<h2>Export</h2>

<p>Export to tab-delimited text files.</p>

<pre><code class="r">f &lt;- &quot;NDCTranslationTable.txt&quot;
write.table(d, f, quote = FALSE, sep = &quot;\t&quot;, row.names = FALSE)
</code></pre>

<p>Print a list of variables in the dataset.</p>

<pre><code class="r">names(d)
</code></pre>

<pre><code>##  [1] &quot;productid&quot;                 &quot;productndc&quot;               
##  [3] &quot;producttypename&quot;           &quot;proprietaryname&quot;          
##  [5] &quot;proprietarynamesuffix&quot;     &quot;nonproprietaryname&quot;       
##  [7] &quot;dosageformname&quot;            &quot;routename&quot;                
##  [9] &quot;startmarketingdate&quot;        &quot;endmarketingdate&quot;         
## [11] &quot;marketingcategoryname&quot;     &quot;applicationnumber&quot;        
## [13] &quot;labelername&quot;               &quot;substancename&quot;            
## [15] &quot;active_numerator_strength&quot; &quot;active_ingred_unit&quot;       
## [17] &quot;pharm_classes&quot;             &quot;deaschedule&quot;              
## [19] &quot;ndcpackagecode&quot;            &quot;packagedescription&quot;       
## [21] &quot;fmtPackageCode&quot;            &quot;ndcPackageFmt11&quot;
</code></pre>

<p>Print a sample of records from the dataset.</p>

<pre><code class="r">d[sample(seq(1, nrow(d)), 10), c(&quot;ndcpackagecode&quot;, &quot;fmtPackageCode&quot;, &quot;ndcPackageFmt11&quot;, 
    &quot;substancename&quot;)]
</code></pre>

<pre><code>##        ndcpackagecode fmtPackageCode ndcPackageFmt11
## 56790    42002-413-09   5-3-2 format     42002041309
## 136285   66993-888-49   5-3-2 format     66993088849
## 45543    36987-1615-3   5-4-1 format     36987161503
## 69331    49288-0881-3   5-4-1 format     49288088103
## 114056   60505-0213-5   5-4-1 format     60505021305
## 143165   68745-1150-2   5-4-1 format     68745115002
## 25994    11822-0375-3   5-4-1 format     11822037503
## 141069   68382-177-10   5-3-2 format     68382017710
## 21360    10006-008-05   5-3-2 format     10006000805
## 96071    54868-6276-0   5-4-1 format     54868627600
##                                                                                                                                                                                                                                                                                                             substancename
## 56790                                                                                                                                                                                                                                                                                          SODIUM MONOFLUOROPHOSPHATE
## 136285                                                                                                                                                                                                                                                                                              CLOBETASOL PROPIONATE
## 45543                                                                                                                                                                                                                                                                                                            CHICKPEA
## 69331  ALTERNARIA ALTERNATA; AMARANTHUS RETROFLEXUS POLLEN; ASPERGILLUS FUMIGATUS; AVENA SATIVA POLLEN; CANIS LUPUS FAMILIARIS HAIR; CARYA ALBA POLLEN; CARYA ILLINOINENSIS POLLEN; DERMATOPHAGOIDES PTERONYSSINUS; PHLEUM PRATENSE POLLEN; PLANTAGO LANCEOLATA POLLEN; PLATANUS OCCIDENTALIS POLLEN; QUERCUS ALBA POLLEN
## 114056                                                                                                                                                                                                                                                                                            DILTIAZEM HYDROCHLORIDE
## 143165                                                                                                                                                                                                                                                                           OCTINOXATE; TITANIUM DIOXIDE; ZINC OXIDE
## 25994                                                                                                                                                                                                                                                                                            LOPERAMIDE HYDROCHLORIDE
## 141069                                                                                                                                                                                                                                                                                           GALANTAMINE HYDROBROMIDE
## 21360                                                                                                                                                                                                                                                                                                              HELIUM
## 96071
</code></pre>

</body>

</html>

